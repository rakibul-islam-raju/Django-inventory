{% extends '../base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block body %}
<main id="purchase-create">

    <div class="" v-if="successMessage">
        <div class="alert alert-sm alert-success alert-dismissible fade show" role="alert">
            [[ successMessage ]]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </div>
    <div class="" v-if="errorMessage">
        <div class="alert alert-sm alert-danger alert-dismissible fade show" role="alert">
            [[ errorMessage ]]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </div>
    <div class="" v-if="formErrors.length > 0">
        <div class="alert alert-sm alert-danger alert-dismissible fade show" role="alert">
            [[ formErrors ]]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <div class="card row mb-4">
                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">{{title|title}}</h6>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-end mb-4">
                        <!-- Button trigger modal -->
                        <div class="buttons-right">
                            <!-- warehouse button -->
                            <button type="button" class="btn btn-sm btn-outline-primary ml-2" data-toggle="modal" data-target="#warehouseModal">
                            <i class="fa fa-plus"></i> Warehouse
                            </button>
                            <!-- category button -->
                            <button type="button" class="btn btn-sm btn-outline-primary ml-2" data-toggle="modal" data-target="#categoryModal">
                            <i class="fa fa-plus"></i> Category
                            </button>
                            <!-- subcategory button -->
                            <button type="button" class="btn btn-sm btn-outline-primary ml-2" data-toggle="modal" data-target="#subCategoryModal">
                            <i class="fa fa-plus"></i> Sub-category
                            </button>
                        </div>

                        <!-- warehouse modal -->
                        <div class="modal fade" id="warehouseModal" tabindex="-1" aria-labelledby="warehouseModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="warehouseModalLabel">Add New Warehouse</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form @submit.prevent="createWarehouse">
                                            {% csrf_token %}
                                            <div class="form-group">
                                                <label for="id_name" class=" requiredField"> Name<span class="asteriskField">*</span></label>
                                                <div class="">
                                                    <input v-model="warehouseName" type="text" name="name" maxlength="100" class="form-control" required="" id="id_name">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="id_description" class=""> Description </label>
                                                <div class="">
                                                    <textarea v-model="warehouseDescription" name="description" cols="40" rows="2" class="textarea form-control" id="id_description"></textarea>
                                                </div>
                                            </div>
                                            <div class="buttons-right">
                                                <button id="warehouseModalClose" type="button" class="btn btn-secondary mr-1" data-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary">Save</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- category modal -->
                        <div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="categoryModalLabel">Add New Category</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form @submit.prevent="createCategory">
                                            {% csrf_token %}
                                            <div id="div_id_name" class="form-group">
                                                <label for="id_name" class=" requiredField"> Name<span class="asteriskField">*</span></label>
                                                <div class="">
                                                    <input v-model="categoryName" type="text" name="name" maxlength="100" class="textinput textInput form-control" required="" id="id_name">
                                                </div>
                                            </div>
                                            <div id="div_id_description" class="form-group">
                                                <label for="id_description" class=""> Description </label>
                                                <div class="">
                                                    <textarea v-model="categoryDescription" name="description" cols="40" rows="2" maxlength="100" class="textarea form-control" id="id_description"></textarea>
                                                </div>
                                            </div>
                                            <div class="buttons-right">
                                                <button id="categoryModalClose" type="button" class="btn btn-secondary mr-1" data-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary">Save</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- subcategory modal -->
                        <div class="modal fade" id="subCategoryModal" tabindex="-1" aria-labelledby="subCategoryModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="subCategoryModalLabel">Add New Sub-Category</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form @submit.prevent="createSubCategory">
                                            {% csrf_token %}
                                            <div id="div_id_sub_category" class="form-group">
                                                <label for="id_sub_category" class=" requiredField"> Category<span class="asteriskField">*</span></label> 
                                                <div class="">
                                                    <select v-model="subcategoryCategory" name="category" class="select form-control" required="" id="id_sub_category">
                                                        <option value="">Select One</option>
                                                        {% for instance in subcategory_form.category.field.queryset %}
                                                            <option value="{{ instance.pk }}">{{ instance.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div id="div_id_name" class="form-group">
                                                <label for="id_name" class=" requiredField"> Name<span class="asteriskField">*</span></label>
                                                <div class="">
                                                    <input v-model="subcategoryName" type="text" name="name" maxlength="100" class="form-control" required="" id="id_name">
                                                </div>
                                            </div>
                                            <div id="div_id_description" class="form-group">
                                                <label for="id_description" class=""> Description </label>
                                                <div class="">
                                                    <textarea v-model="subcategoryDescription" name="description" cols="40" rows="2" maxlength="100" class="textarea form-control" id="id_description"></textarea>
                                                </div>
                                            </div>
                                            <div class="buttons-right">
                                                <button id="subcategoryModalClose" type="button" class="btn btn-secondary mr-1" data-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary">Save</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="Product-form">
                        <form action="" method="POST">
                            {% csrf_token %}
                            <div class="form-group">
                                {% comment %} <div class="row">
                                    <div class="col-md-4">
                                        {{form.warehouse|as_crispy_field}}
                                    </div>
                                    <div class="col-md-4"> 
                                        <div id="div_id_category" class="form-group">
                                            <label for="id_category" class=" requiredField">Category<span class="asteriskField">*</span></label>
                                            <div class="">
                                                <select @change="selectSubcategory()" id="id_category" name="category" class="select form-control">
                                                    {% for id, name in form.category.field.choices %}
                                                    <option value="{{ id }}">{{ name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4"> 
                                        <div id="div_id_sub_category" class="form-group">
                                            <label for="id_sub_category" class=""> Sub category </label>
                                            <div class="">
                                                <select v-model="subcategoryOption" name="sub_category" class="select form-control" id="id_sub_category">
                                                    <option v-for="subcategory in selectSubcategories" :value="subcategory.id">[[ subcategory.name ]]</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div> {% endcomment %}
                                <div class="row">
                                    <div class="col-md-3">
                                        {{form.product|as_crispy_field}}
                                    </div>
                                    <div class="col-md-3">
                                        {{form.price|as_crispy_field}}
                                    </div>
                                    <div class="col-md-3">
                                        {{form.quantity|as_crispy_field}}
                                    </div>
                                    <div class="col-md-3">
                                        <label for="id_payment_type" class=" requiredField"> Payment type<span class="asteriskField">*</span></label>
                                        <select name="payment_type" class="select form-control" required="" id="id_payment_type" v-model="paymentMethod" @change="paymentBank()">
                                            <option value="">---------</option>
                                            <option value="bank">Bank</option>
                                            <option value="cash">Cash</option>
                                        </select>

                                    </div>

                                </div>

                                    <!-- if payment method is bank -->
                                <div class="row" v-if="bankOption">
                                    <div class="col-md-4">
                                        {{form.bank|as_crispy_field}}
                                    </div>
                                    <div class="col-md-4">
                                        {{form.check_no|as_crispy_field}}
                                    </div>
                                    <div class="col-md-4">
                                        {{form.check_date|as_crispy_field}}
                                    </div>
                                </div>
                                    <!-- endif -->

                                <div class="row">

                                    <div class="col-md-6">
                                        {{form.remark|as_crispy_field}}
                                    </div>
                                </>
                            </div>

                            <div class="d-flex justify-content-end">
                                <a class="mr-1 btn btn-secondary" href="{% url 'purchase:purchase-create' %}">Reset</a>
                                <button class="btn btn-primary ml-2" type="submit">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

{% endblock body %}


{% block extra_script %}
<script src="{% static 'js/purchases/purchase-create.js' %}"></script>
{% endblock extra_script %}